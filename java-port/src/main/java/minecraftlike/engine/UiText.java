package minecraftlike.engine;

import java.util.HashMap;
import java.util.Map;

/**
 * Tiny 5x7 bitmap font rendered via UiRenderer.drawRect.
 * Minimal and dependency-free (good enough for a simple debug/settings menu).
 */
public final class UiText {
    // Each glyph is 7 rows, 5 bits wide (MSB on the left).
    private static final Map<Character, int[]> GLYPHS = new HashMap<>();

    static {
        // Space
        g(' ',
            "00000",
            "00000",
            "00000",
            "00000",
            "00000",
            "00000",
            "00000"
        );
        // Digits
        g('0',"01110","10001","10011","10101","11001","10001","01110");
        g('1',"00100","01100","00100","00100","00100","00100","01110");
        g('2',"01110","10001","00001","00010","00100","01000","11111");
        g('3',"11110","00001","00001","01110","00001","00001","11110");
        g('4',"00010","00110","01010","10010","11111","00010","00010");
        g('5',"11111","10000","10000","11110","00001","00001","11110");
        g('6',"00110","01000","10000","11110","10001","10001","01110");
        g('7',"11111","00001","00010","00100","01000","01000","01000");
        g('8',"01110","10001","10001","01110","10001","10001","01110");
        g('9',"01110","10001","10001","01111","00001","00010","01100");

        // Letters (uppercase)
        g('A',"01110","10001","10001","11111","10001","10001","10001");
        g('B',"11110","10001","10001","11110","10001","10001","11110");
        g('C',"01110","10001","10000","10000","10000","10001","01110");
        g('D',"11110","10001","10001","10001","10001","10001","11110");
        g('E',"11111","10000","10000","11110","10000","10000","11111");
        g('F',"11111","10000","10000","11110","10000","10000","10000");
        g('G',"01110","10001","10000","10111","10001","10001","01110");
        g('H',"10001","10001","10001","11111","10001","10001","10001");
        g('I',"01110","00100","00100","00100","00100","00100","01110");
        g('J',"00001","00001","00001","00001","10001","10001","01110");
        g('K',"10001","10010","10100","11000","10100","10010","10001");
        g('L',"10000","10000","10000","10000","10000","10000","11111");
        g('M',"10001","11011","10101","10101","10001","10001","10001");
        g('N',"10001","11001","10101","10011","10001","10001","10001");
        g('O',"01110","10001","10001","10001","10001","10001","01110");
        g('P',"11110","10001","10001","11110","10000","10000","10000");
        g('Q',"01110","10001","10001","10001","10101","10010","01101");
        g('R',"11110","10001","10001","11110","10100","10010","10001");
        g('S',"01111","10000","10000","01110","00001","00001","11110");
        g('T',"11111","00100","00100","00100","00100","00100","00100");
        g('U',"10001","10001","10001","10001","10001","10001","01110");
        g('V',"10001","10001","10001","10001","10001","01010","00100");
        g('W',"10001","10001","10001","10101","10101","11011","10001");
        g('X',"10001","10001","01010","00100","01010","10001","10001");
        g('Y',"10001","10001","01010","00100","00100","00100","00100");
        g('Z',"11111","00001","00010","00100","01000","10000","11111");

        // Symbols
        g(':',"00000","00100","00100","00000","00100","00100","00000");
        g('.',"00000","00000","00000","00000","00000","00110","00110");
        g('-',"00000","00000","00000","11111","00000","00000","00000");
        g('+',"00000","00100","00100","11111","00100","00100","00000");
        g('(',"00010","00100","01000","01000","01000","00100","00010");
        g(')',"01000","00100","00010","00010","00010","00100","01000");
        g('/',"00001","00010","00100","01000","10000","00000","00000");
    }

    private static void g(char c, String r0, String r1, String r2, String r3, String r4, String r5, String r6) {
        GLYPHS.put(c, new int[] {
            bits(r0), bits(r1), bits(r2), bits(r3), bits(r4), bits(r5), bits(r6)
        });
    }

    private static int bits(String row) {
        int b = 0;
        for (int i = 0; i < 5; i++) {
            b <<= 1;
            if (row.charAt(i) == '1') b |= 1;
        }
        return b;
    }

    public void draw(UiRenderer ui, float x, float y, int screenW, int screenH, String text, float scale, float r, float g, float b, float a) {
        float cx = x;
        for (int i = 0; i < text.length(); i++) {
            char ch = Character.toUpperCase(text.charAt(i));
            int[] glyph = GLYPHS.getOrDefault(ch, GLYPHS.get(' '));
            drawGlyph(ui, cx, y, screenW, screenH, glyph, scale, r, g, b, a);
            cx += (6f * scale); // 5px + 1px spacing
        }
    }

    private void drawGlyph(UiRenderer ui, float x, float y, int screenW, int screenH, int[] rows, float scale, float r, float g, float b, float a) {
        for (int row = 0; row < 7; row++) {
            int mask = rows[row];
            for (int col = 0; col < 5; col++) {
                int bit = (mask >> (4 - col)) & 1;
                if (bit == 0) continue;
                ui.drawRect(x + col * scale, y + row * scale, scale, scale, screenW, screenH, r, g, b, a);
            }
        }
    }
}
